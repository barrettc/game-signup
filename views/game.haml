%div{:class => "well span10 offset1"}
  %div{:id => "flash-message"}
    =styled_flash
  %h3 Game: #{@game.date.localtime.strftime("%A, %B %e, %Y, %l:%M %p")}
  %div{:id => "playerList"}
    = haml :playerList
  %div{:id => "waitingList"}
    = haml :waitingList
  %br
  %div{:id => "gameButtons"}
    = haml :gameButtons
  %br
  %h3 Map
  %div{:id => "map_canvas", :class => "map"}
:javascript
  $('#signup').live('click', function () {
      var signup = $.ajax({
          url: '/game/#{params[:id]}/user/#{session[:user]}',
          type:'put'
      });

      signup.success(function () {
          $('#playerList').load('/game/#{params[:id]}/playerList');
          $('#waitingList').load('/game/#{params[:id]}/waitingList');
          $('#gameButtons').load('/game/#{params[:id]}/gameButtons');
      })
  });

  $('#remove').live('click', function () {
      var remove = $.ajax({
          url: '/game/#{params[:id]}/user/#{session[:user]}',
          type:'delete'
      });

      remove.success(function () {
          $('#playerList').load('/game/#{params[:id]}/playerList');
          $('#waitingList').load('/game/#{params[:id]}/waitingList');
          $('#gameButtons').load('/game/#{params[:id]}/gameButtons');
      })
  });

  function initialize() {
    var latlng = new google.maps.LatLng(#{@game.address.coordinates[1]},#{@game.address.coordinates[0]});

    var mapOptions = {
      zoom: 13,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

    var marker = new google.maps.Marker({
      position: latlng,
      map: map,
      title: "#{@game.address.address}"
    });

    var contentStr = "<strong>Host: #{@hostName}</strong><br>#{@game.address.street}<br>#{@game.address.city}, #{@game.address.state} #{@game.address.zipCode}";

    var infowindow = new google.maps.InfoWindow({
      content: contentStr
    });

    google.maps.event.addListener(marker, 'click', function() {
      infowindow.open(map,marker);
    });
  }

  function loadScript() {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "http://maps.googleapis.com/maps/api/js?&sensor=true&callback=initialize";
    document.body.appendChild(script);
  }

  window.onload = loadScript;